#!/bin/bash

# Workaround for https://github.com/flang-compiler/flang/issues/1398

"/opt/llvm/bin/flang1" /openmp-offload-example/src/example.f90 -x 69 0x1000 -opt 2 -terse 1 -inform warn -nohpf -nostatic -cmdline "'+flang -O2 -fopenmp -fopenmp-targets=x86_64,nvptx64-nvidia-cuda /openmp-offload-example/src/example.f90 -o /openmp-offload-example/build/example -v'" -inform warn -mp -x 69 0x200 -x 69 0x400 -y 129 2 -ieee 1 -x 19 0x400000 -quad -x 68 0x1 -x 59 4 -x 15 2 -x 49 0x400004 -x 51 0x20 -x 57 0x4c -x 58 0x10000 -x 124 0x1000 -tp px -x 57 0xfb0000 -x 58 0x78031040 -x 47 0x08 -x 48 4608 -x 49 0x100 -x 70 0x6c00 -x 119 0x10000000 -x 129 2 -x 47 0x400000 -x 52 2 -stdinc /opt/llvm/bin/../include:/usr/local/include:/opt/llvm/lib/clang/15.0.3/include:/usr/include/x86_64-linux-gnu:/include:/usr/include -def __GCC_ASM_FLAG_OUTPUTS__=1 -def __code_model___=1 -def __amd64__=1 -def __amd64=1 -def __x86_64=1 -def __x86_64__=1 -def __SEG_GS=1 -def __SEG_FS=1 -def __seg_gs="__attribute__((address_space(256)))" -def __seg_fs="__attribute__((address_space(257)))" -def __REGISTER_PREFIX__= -def __NO_MATH_INLINES=1 -def __SSE2__=1 -def __SSE2_MATH__=1 -def __SSE__=1 -def __SSE_MATH__=1 -def __MMX__=1 -def __GCC_HAVE_SYNC_COMPARE_AND_SWAP_1=1 -def __GCC_HAVE_SYNC_COMPARE_AND_SWAP_2=1 -def __GCC_HAVE_SYNC_COMPARE_AND_SWAP_4=1 -def __GCC_HAVE_SYNC_COMPARE_AND_SWAP_8=1 -def __SIZEOF_FLOAT128__=16 -def unix=1 -def __unix=1 -def __unix__=1 -def linux=1 -def __linux=1 -def __linux__=1 -def __ELF__=1 -def __gnu_linux__=1 -def __FLOAT128__=1 -def "__SIZE_TYPE__=long unsigned int" -def "__PTRDIFF_TYPE__=long int" -def _LP64=1 -def __LP64__=1 -def __LONG_MAX__=9223372036854775807L -def __amd_64__amd64__ -def __k8 -def __k8__ -def __THROW= -def __extension__= -def __PGLLVM__ -freeform -vect 48 -x 54 1 -x 70 0x40000000 -y 163 0xc0000000 -x 189 0x10 -stbfile example-40222e.stb -modexport example-40222e.cmod -modindex example-40222e.cmdx -output example-40222e.ilm -fopenmp-targets x86_64,nvptx64-nvidia-cuda

"/opt/llvm/bin/flang2" example-40222e.ilm -y 129 2 -x 172 0x40000000 -x 179 1 -x 216 0x1000 -x 6 0x100 -x 42 0x400000 -y 129 4 -x 129 0x400 -y 216 1 -fn /openmp-offload-example/src/example.f90 -opt 2 -terse 1 -inform warn -cmdline "'+flang -O2 -fopenmp -fopenmp-targets=x86_64,nvptx64-nvidia-cuda /openmp-offload-example/src/example.f90 -o /openmp-offload-example/build/example -v'" -inform warn -mp -x 69 0x200 -x 69 0x400 -y 129 2 -ieee 1 -x 68 0x1 -x 51 0x20 -x 119 0xa10000 -x 122 0x40 -x 123 0x1000 -x 127 4 -x 127 17 -x 19 0x400000 -x 28 0x40000 -x 120 0x10000000 -x 70 0x8000 -x 122 1 -x 125 0x20000 -x 164 0x800000 -quad -x 59 4 -tp px -x 120 0x1000 -x 124 0x1400 -y 15 2 -x 57 0x3b0000 -x 58 0x48000000 -x 49 0x100 -astype 0 -x 183 4 -x 121 0x800 -x 54 0x10 -x 70 0x40000000 -x 249 150 -x 124 1 -y 163 0xc0000000 -x 189 0x10 -y 189 0x4000000 -x 183 0x10 -stbfile example-40222e.stb -fopenmp-targets x86_64,nvptx64-nvidia-cuda -fopenmp-targets-asm /tmp/example-40222e-x86_64.ll -asm /tmp/example-40222e.ll
